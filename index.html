
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Microlearn Bio</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#15171A" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Microlearn Bio" />
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png" />
  <link rel="icon" href="/icons/icon-192.png" sizes="192x192" />
  <link rel="manifest" href="/manifest.webmanifest" />
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png" />
  <link rel="icon" href="/icons/icon-192.png" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="app">
    <header class="app-header">
      <button class="icon-button back-button hidden" id="backButton" aria-label="Back">←</button>
      <button class="icon-button icon-button--gear hidden" id="settingsButton" aria-label="Open settings">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <circle cx="12" cy="12" r="3.5"></circle>
          <path d="M19.4 15a1.7 1.7 0 0 0 .34 1.87l.05.05a2 2 0 1 1-2.83 2.83l-.05-.05a1.7 1.7 0 0 0-1.87-.34 1.7 1.7 0 0 0-1 1.54V21a2 2 0 1 1-4 0v-.08a1.7 1.7 0 0 0-1-1.54 1.7 1.7 0 0 0-1.87.34l-.05.05a2 2 0 1 1-2.83-2.83l.05-.05a1.7 1.7 0 0 0 .34-1.87 1.7 1.7 0 0 0-1.54-1H3a2 2 0 1 1 0-4h.08a1.7 1.7 0 0 0 1.54-1 1.7 1.7 0 0 0-.34-1.87l-.05-.05a2 2 0 1 1 2.83-2.83l.05.05a1.7 1.7 0 0 0 1.87.34h0A1.7 1.7 0 0 0 9 3.08V3a2 2 0 1 1 4 0v.08a1.7 1.7 0 0 0 1 1.54h0a1.7 1.7 0 0 0 1.87-.34l.05-.05a2 2 0 1 1 2.83 2.83l-.05.05a1.7 1.7 0 0 0-.34 1.87v0A1.7 1.7 0 0 0 20.92 11H21a2 2 0 1 1 0 4h-.08a1.7 1.7 0 0 0-1.54 1z"></path>
        </svg>
      </button>
      <div class="header-title">
        <h1 id="headerTitle" class="header-main"></h1>
        <span id="headerSubtitle" class="header-subtitle"></span>
      </div>
      <button id="streakChip" class="streak-chip hidden" type="button" aria-label="View streak" aria-haspopup="dialog" aria-controls="streakSheet">
        <span class="streak-chip__icon" aria-hidden="true"></span>
        <span id="streakChipCount" class="streak-chip__count">0</span>
      </button>
      <button class="icon-button" id="themeToggle" aria-label="Toggle theme">☾</button>
    </header>

    <main class="app-main">
      <!-- Screen 1: Level selection (AS / A2) -->
      <section id="screenLevels" class="screen active">
        <div class="hero">
          <h2>Microlearning for A-Level Biology</h2>
          <p>Tiny lessons. Fast recall.</p>
        </div>
        <div id="resumeCard" class="card resume-card hidden" role="button" tabindex="0" aria-label="Resume last session">
          <div class="resume-card__text">
            <div class="resume-card__title">Resume</div>
            <div id="resumeSubtitle" class="resume-card__subtitle"></div>
          </div>
          <div class="resume-card__actions">
            <button id="resumeButton" class="btn btn--small" type="button">Continue</button>
            <button id="resumeDismiss" class="icon-button resume-card__dismiss" type="button" aria-label="Dismiss resume">×</button>
          </div>
        </div>
        <div class="card-grid">
          <button class="card card-select" data-level="as">
            <h3>AS Level</h3>
            <p>11 chapters · foundation concepts</p>
          </button>
          <button class="card card-select" data-level="a2">
            <h3>A2 Level</h3>
            <p>8 chapters · advanced topics</p>
          </button>
        </div>
      </section>

      <!-- Screen 2: Chapter list -->
      <section id="screenChapters" class="screen hidden">
        <div id="chaptersList" class="card-list"></div>
      </section>

      <!-- Screen 3: Chapter objectives (A2 Chapter 12) -->
      <section id="screenObjectives" class="screen hidden">
        <div class="objectives-intro">
          <div class="objectives-intro__title">Pick an objective to focus on</div>
          <div class="objectives-intro__subtitle">Or continue the full chapter.</div>
        </div>
        <div id="objectivesList" class="objectives-list"></div>
        <div class="objectives-footer">
          <div class="objectives-footer__continue">
            <button id="objectivesContinue" class="btn objectives-footer__button" type="button">
              <span class="objectives-footer__button-content flex flex-col items-center leading-tight">
                <span class="text-base font-medium">Continue full chapter</span>
                <span class="text-xs text-muted-foreground objectives-footer__button-caption">
                  Includes all objectives
                </span>
              </span>
            </button>
          </div>
        </div>
      </section>

      <!-- Screen 3: Chapter modes (Story / Questions / Revision) -->
      <section id="screenChapter" class="screen hidden">
        <div class="tabs" id="modeTabs">
          <button class="tab active" data-mode="story">Points</button>
          <button class="tab" data-mode="questions">Questions</button>
          <button class="tab" data-mode="revision">Revision</button>
        </div>

        <div class="progress-wrapper">
          <div class="progress-label" id="progressLabel">0 / 0</div>
          <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
          </div>
        </div>

        <!-- Story mode content -->
        <div id="storyMode" class="mode-panel active">
          <div id="storyFeed" class="bubble-feed"></div>
        </div>

        <!-- Question mode content -->
        <div id="questionsMode" class="mode-panel hidden">
          <div id="questionArea" class="qa-wrapper"></div>
        </div>

        <!-- Revision content -->
        <div id="revisionMode" class="mode-panel hidden">
          <div class="revision-header">
            <div class="segmented" role="tablist" aria-label="Revision type">
              <button class="segmented__btn" data-revision-submode="story" aria-pressed="true">Points</button>
              <button class="segmented__btn" data-revision-submode="questions" aria-pressed="false">Questions</button>
            </div>
          </div>

          <div id="revisionHub">
            <div id="revisionEmpty" class="empty-state">
              Nothing saved yet. Tap the
              <span class="inline-icon" aria-hidden="true">
                <svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M2.5 5.5A2.5 2.5 0 0 1 5 3h6a2 2 0 0 1 2 2v16a2 2 0 0 0-2-2H5a2.5 2.5 0 0 0-2.5 2.5V5.5z" />
                  <path d="M21.5 5.5A2.5 2.5 0 0 0 19 3h-6a2 2 0 0 0-2 2v16a2 2 0 0 1 2-2h6a2.5 2.5 0 0 1 2.5 2.5V5.5z" />
                </svg>
              </span>
              button to save items for revision.
            </div>
            <ul id="revisionList" class="revision-list"></ul>
            <div class="revision-actions">
              <div id="revisionSelectionBar" class="revision-selection hidden">
                <span id="revisionSelectedCount" class="revision-selection-count">0 selected</span>
                <div class="revision-selection-actions">
                  <button id="revisionSelectAll" class="btn btn--ghost btn--small" type="button">Select all</button>
                  <button id="revisionClearSelection" class="btn btn--ghost btn--small" type="button">Clear</button>
                </div>
              </div>
              <div class="revision-action-buttons">
                <button id="revisionStartBtn" class="btn" disabled>Start revision</button>
              </div>
            </div>
          </div>

          <div id="revisionConfig" class="revision-config hidden">
            <div class="revision-config-card">
              <div class="revision-config-section">
                <div class="revision-config-title">How many items?</div>
                <div class="pill-group" id="revisionCountOptions">
                  <button class="pill" data-count="5">5</button>
                  <button class="pill" data-count="10">10</button>
                  <button class="pill" data-count="15">15</button>
                  <button class="pill" data-count="all">All</button>
                  <button class="pill" data-count="select">Select</button>
                </div>
              </div>
              <div class="revision-config-section">
                <div class="revision-config-title">Order</div>
                <div class="segmented" id="revisionOrderOptions" role="group" aria-label="Revision order">
                  <button class="segmented__btn" data-order="in-order" aria-pressed="true">In order</button>
                  <button class="segmented__btn" data-order="random" aria-pressed="false">Random</button>
                </div>
              </div>
              <div class="revision-config-actions">
                <button id="revisionConfigCancel" class="btn btn--ghost">Cancel</button>
                <button id="revisionConfigStart" class="btn">Start</button>
              </div>
            </div>
          </div>

          <div id="revisionSession" class="revision-session hidden"></div>
        </div>

        <!-- Floating actions (Story + Questions only, plus Revision sessions) -->
        <div id="actionDock" class="action-dock hidden" aria-label="Actions">
          <button id="actionLeft" class="fab fab--circle fab--secondary" aria-label="Add to Revision" title="Add to Revision">
            <svg class="fab__icon" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <path d="M2.5 5.5A2.5 2.5 0 0 1 5 3h6a2 2 0 0 1 2 2v16a2 2 0 0 0-2-2H5a2.5 2.5 0 0 0-2.5 2.5V5.5z" />
              <path d="M21.5 5.5A2.5 2.5 0 0 0 19 3h-6a2 2 0 0 0-2 2v16a2 2 0 0 1 2-2h6a2.5 2.5 0 0 1 2.5 2.5V5.5z" />
            </svg>
          </button>
          <button id="actionRight" class="fab fab--circle fab--primary" aria-label="OK" title="OK">OK</button>
        </div>
      </section>
    </main>
  </div>

  <div id="revisionSwitchDialog" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="revisionSwitchTitle">
    <div class="modal__card">
      <div id="revisionSwitchTitle" class="modal__title">End this session to switch modes?</div>
      <div class="modal__actions">
        <button id="revisionSwitchCancel" class="btn btn--ghost">Cancel</button>
        <button id="revisionSwitchConfirm" class="btn">End &amp; Switch</button>
      </div>
    </div>
  </div>

  <div id="settingsModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="settingsTitle">
    <div class="modal__card modal__card--settings">
      <div class="modal__header">
        <div id="settingsTitle" class="modal__title">Settings</div>
        <button id="settingsClose" class="icon-button icon-button--flat icon-button--small" aria-label="Close settings">×</button>
      </div>
      <div class="settings-section">
        <div class="settings-section-title">Progress</div>
        <div class="settings-scope">
          <div class="settings-field">
            <span class="settings-field-label">Level</span>
            <button id="settingsLevelPicker" class="settings-picker" type="button" aria-haspopup="dialog" aria-controls="levelSheet">
              <span id="settingsLevelValue" class="settings-picker__value"></span>
              <span class="settings-picker__icon" aria-hidden="true">⌄</span>
            </button>
          </div>
          <div class="settings-field">
            <span class="settings-field-label">Chapter</span>
            <button id="settingsChapterPicker" class="settings-picker" type="button" aria-haspopup="dialog" aria-controls="chapterSheet">
              <span id="settingsChapterValue" class="settings-picker__value"></span>
              <span class="settings-picker__icon" aria-hidden="true">⌄</span>
            </button>
          </div>
        </div>
        <div class="settings-actions">
          <button class="btn btn--warning" type="button" data-reset="points">Reset Points progress</button>
          <button class="btn btn--warning" type="button" data-reset="questions">Reset Questions progress</button>
          <button class="btn btn--warning" type="button" data-reset="all">Reset ALL progress</button>
          <button id="clearResume" class="btn btn--ghost" type="button">Clear resume</button>
        </div>
      </div>
      <div class="settings-section">
        <div class="settings-section-title">Backup</div>
        <div class="settings-actions">
          <button id="exportBackup" class="btn" type="button">Export backup</button>
          <button id="importBackup" class="btn btn--ghost" type="button">Import backup</button>
          <input id="importFile" class="visually-hidden" type="file" accept="application/json" />
        </div>
        <p class="settings-help">Backups only include Microlearn Bio data stored on this device.</p>
      </div>
    </div>
  </div>

  <div id="levelSheet" class="bottom-sheet hidden" role="dialog" aria-modal="true" aria-labelledby="levelSheetTitle">
    <div class="bottom-sheet__backdrop" data-sheet-close></div>
    <div class="bottom-sheet__panel">
      <div class="bottom-sheet__header">
        <div id="levelSheetTitle" class="bottom-sheet__title">Choose level</div>
        <button class="icon-button icon-button--flat icon-button--small" type="button" data-sheet-close aria-label="Close level picker">×</button>
      </div>
      <div id="levelSheetOptions" class="bottom-sheet__list"></div>
    </div>
  </div>

  <div id="chapterSheet" class="bottom-sheet hidden" role="dialog" aria-modal="true" aria-labelledby="chapterSheetTitle">
    <div class="bottom-sheet__backdrop" data-sheet-close></div>
    <div class="bottom-sheet__panel">
      <div class="bottom-sheet__header">
        <div id="chapterSheetTitle" class="bottom-sheet__title">Choose chapter</div>
        <button class="icon-button icon-button--flat icon-button--small" type="button" data-sheet-close aria-label="Close chapter picker">×</button>
      </div>
      <div id="chapterSheetOptions" class="bottom-sheet__list"></div>
    </div>
  </div>

  <div id="streakSheet" class="bottom-sheet hidden streak-sheet" role="dialog" aria-modal="true" aria-labelledby="streakSheetTitle">
    <div class="bottom-sheet__backdrop" data-sheet-close></div>
    <div class="bottom-sheet__panel">
      <div class="bottom-sheet__header streak-sheet__header">
        <div class="streak-sheet__title-group">
          <div id="streakSheetTitle" class="bottom-sheet__title">Streak</div>
          <div id="streakSheetChip" class="streak-chip streak-chip--header" aria-label="Current streak">
            <span class="streak-chip__icon" aria-hidden="true"></span>
            <span id="streakSheetCount" class="streak-chip__count">0</span>
          </div>
        </div>
        <button class="icon-button icon-button--flat icon-button--small" type="button" data-sheet-close aria-label="Close streak details">×</button>
      </div>
      <div class="streak-sheet__body">
        <div class="streak-row">
          <span class="streak-row__label">Current</span>
          <span id="streakCurrentValue" class="streak-row__value">0 days</span>
        </div>
        <div class="streak-row">
          <span class="streak-row__label">Longest</span>
          <span id="streakLongestValue" class="streak-row__value">0 days</span>
        </div>
        <div class="streak-row">
          <span class="streak-row__label">Last studied</span>
          <span id="streakLastValue" class="streak-row__value">Today</span>
        </div>
        <div id="streakDots" class="streak-dots" aria-label="7-day streak indicator" role="img">
          <span class="streak-dot"></span>
          <span class="streak-dot"></span>
          <span class="streak-dot"></span>
          <span class="streak-dot"></span>
          <span class="streak-dot"></span>
          <span class="streak-dot"></span>
          <span class="streak-dot"></span>
        </div>
      </div>
    </div>
  </div>

  <div id="confirmDialog" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="confirmTitle">
    <div class="modal__card">
      <div class="modal__header">
        <div id="confirmTitle" class="modal__title">Confirm</div>
        <button id="confirmClose" class="icon-button icon-button--flat icon-button--small" aria-label="Close dialog">×</button>
      </div>
      <div id="confirmMessage" class="modal__text">This will permanently clear your local progress on this device.</div>
      <div class="modal__actions">
        <button id="confirmCancel" class="btn btn--ghost">Cancel</button>
        <button id="confirmConfirm" class="btn btn--warning">Reset</button>
      </div>
    </div>
  </div>

  <div id="toast" class="toast hidden" role="status" aria-live="polite"></div>
  <div id="updateToast" class="toast toast--action hidden" role="status" aria-live="polite">
    <span>Update available</span>
    <div class="toast__actions">
      <button id="updateRefresh" class="btn btn--small" type="button">Refresh</button>
      <button id="updateLater" class="btn btn--ghost btn--small" type="button">Later</button>
    </div>
  </div>

  <script src="script.js" defer></script>
</body>
</html>
